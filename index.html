<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Information Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        
        .required::after {
            content: " *";
            color: red;
        }
        
        .preview-image {
            max-width: 150px;
            max-height: 150px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .tab-content {
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .nav-tabs .nav-link {
            color: var(--dark-color);
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .payment-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            text-align: center;
        }
        
        .download-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .social-media-icons {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .qr-code-container {
            text-align: center;
            margin-top: 20px;
        }
        
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }
        
        .id-controls {
            display: flex;
            align-items: center;
        }
        
        .id-controls input {
            border-radius: 5px 0 0 5px;
        }
        
        .id-controls .btn-group {
            margin-left: -1px;
        }
        
        .id-controls .btn {
            border-radius: 0;
            padding: 0.375rem 0.75rem;
        }
        
        .id-controls .btn:last-child {
            border-radius: 0 5px 5px 0;
        }
        
        .template-download {
            margin-top: 10px;
        }
        
        .upwork-logo {
            color: #14a800;
        }
        
        .imo-logo {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .form-text {
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .file-info {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .qr-download-btn {
            margin-top: 10px;
        }
        
        .scroll-to-top {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .scroll-to-bottom {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .scroll-to-top:hover, .scroll-to-bottom:hover {
            opacity: 0.9;
            transform: scale(1.1);
            transition: all 0.3s ease;
        }
        
        .debug-info {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Scroll Buttons -->
    <button class="scroll-to-top" id="scrollToTopBtn">
        <i class="fas fa-arrow-up"></i>
    </button>
    <button class="scroll-to-bottom" id="scrollToBottomBtn">
        <i class="fas fa-arrow-down"></i>
    </button>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-address-book me-2"></i>Contact Manager</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-1"></i>Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Login/Signup Container -->
    <div class="container" id="authContainer">
        <div class="login-container">
            <h2 class="text-center mb-4">Welcome</h2>
            <ul class="nav nav-tabs" id="authTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="signin-tab" data-bs-toggle="tab" href="#signin">Sign In</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="signup-tab" data-bs-toggle="tab" href="#signup">Sign Up</a>
                </li>
            </ul>
            <div class="tab-content p-3 border border-top-0 rounded-bottom">
                <div class="tab-pane fade show active" id="signin">
                    <form id="signinForm">
                        <div class="mb-3">
                            <label for="signinEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="signinEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="signinPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="signinPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Sign In</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="signup">
                    <form id="signupForm">
                        <div class="mb-3">
                            <label for="signupName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="signupName" required>
                        </div>
                        <div class="mb-3">
                            <label for="signupEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="signupEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="signupPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="signupPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Sign Up</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div class="container mt-4" id="appContainer" style="display: none;">
        <div class="row">
            <div class="col-md-12">
                <h1 class="text-center mb-4">Contact Information Manager</h1>
                
                <!-- File Upload Section -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-file-upload me-2"></i>Upload Contact File
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="fileUpload" class="form-label">Upload CSV or Excel file</label>
                            <input class="form-control" type="file" id="fileUpload" accept=".csv,.xlsx,.xls">
                            <div class="form-text">Download template file to ensure proper formatting</div>
                        </div>
                        <div class="mb-3">
                            <button class="btn btn-primary" id="uploadBtn">Upload File</button>
                            <button class="btn btn-outline-secondary template-download" id="downloadTemplateBtn">
                                <i class="fas fa-download me-1"></i>Download Template
                            </button>
                        </div>
                        <div id="uploadStatus"></div>
                        <div id="fileInfo" class="file-info" style="display: none;">
                            <h6>File Information:</h6>
                            <div id="fileDetails"></div>
                        </div>
                        <div id="debugInfo" class="debug-info" style="display: none;">
                            <h6>Debug Information:</h6>
                            <div id="debugDetails"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Contact Form -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-user me-2"></i>Contact Information Form
                    </div>
                    <div class="card-body">
                        <form id="contactForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="contactId" class="form-label">Contact ID (for data lookup)</label>
                                    <div class="id-controls">
                                        <input type="text" class="form-control" id="contactId" value="1">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-outline-secondary" id="decreaseIdBtn">-</button>
                                            <button type="button" class="btn btn-outline-secondary" id="increaseIdBtn">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 d-flex align-items-end">
                                    <button type="button" class="btn btn-outline-primary" id="fetchDataBtn">Fetch Data from File</button>
                                </div>
                            </div>
                            
                            <!-- Personal Information -->
                            <div class="form-section">
                                <h4 class="section-title">Personal Information</h4>
                                
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="imageUpload" class="form-label required">Profile Image</label>
                                        <input class="form-control" type="file" id="imageUpload" accept=".jpg,.jpeg,.png" required>
                                    </div>
                                    <div class="col-md-2">
                                        <img id="imagePreview" src="#" alt="Image Preview" class="preview-image" style="display: none;">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="firstName" class="form-label required">First Name</label>
                                        <input type="text" class="form-control" id="firstName" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="middleName" class="form-label">Middle Name</label>
                                        <input type="text" class="form-control" id="middleName">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="lastName" class="form-label required">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" required>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="nickName" class="form-label">Nickname</label>
                                        <input type="text" class="form-control" id="nickName">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="dob" class="form-label">Date of Birth</label>
                                        <input type="text" class="form-control" id="dob" placeholder="DD-MM-YYYY or DD-MMM">
                                        <div class="form-text">Format: DD-MM-YYYY (with year) or DD-MMM (without year)</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="phoneHome" class="form-label">Phone (Home)</label>
                                        <input type="text" class="form-control" id="phoneHome">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phoneMobile" class="form-label required">Phone (Mobile)</label>
                                        <input type="text" class="form-control" id="phoneMobile" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="emailPersonal" class="form-label">Email (Personal)</label>
                                    <input type="email" class="form-control" id="emailPersonal">
                                </div>
                                
                                <h5>Address</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="street1Personal" class="form-label">Street 1</label>
                                        <input type="text" class="form-control" id="street1Personal">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="street2Personal" class="form-label">Street 2</label>
                                        <input type="text" class="form-control" id="street2Personal">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="cityPersonal" class="form-label">City</label>
                                        <input type="text" class="form-control" id="cityPersonal">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="zipPersonal" class="form-label">ZIP Code</label>
                                        <input type="text" class="form-control" id="zipPersonal">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="countryPersonal" class="form-label">Country</label>
                                        <select class="form-select" id="countryPersonal">
                                            <option value="">Select Country</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Work Information -->
                            <div class="form-section">
                                <h4 class="section-title">Work Information</h4>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="company" class="form-label">Company</label>
                                        <input type="text" class="form-control" id="company">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="department" class="form-label">Department</label>
                                        <input type="text" class="form-control" id="department">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="designation" class="form-label">Designation</label>
                                        <input type="text" class="form-control" id="designation">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="role" class="form-label">Role</label>
                                        <input type="text" class="form-control" id="role">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="phoneWork" class="form-label">Phone (Work)</label>
                                        <input type="text" class="form-control" id="phoneWork">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="emailWork" class="form-label">Email (Work)</label>
                                        <input type="email" class="form-control" id="emailWork">
                                    </div>
                                </div>
                                
                                <h5>Work Address</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="street1Work" class="form-label">Street 1</label>
                                        <input type="text" class="form-control" id="street1Work">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="street2Work" class="form-label">Street 2</label>
                                        <input type="text" class="form-control" id="street2Work">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="cityWork" class="form-label">City</label>
                                        <input type="text" class="form-control" id="cityWork">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="zipWork" class="form-label">ZIP Code</label>
                                        <input type="text" class="form-control" id="zipWork">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="countryWork" class="form-label">Country</label>
                                        <select class="form-select" id="countryWork">
                                            <option value="">Select Country</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="webAddress" class="form-label">Web Address</label>
                                    <input type="url" class="form-control" id="webAddress">
                                </div>
                            </div>
                            
                            <!-- Instant Messaging -->
                            <div class="form-section">
                                <h4 class="section-title">Instant Messaging</h4>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="whatsapp" class="form-label"><i class="fab fa-whatsapp social-media-icons text-success"></i>WhatsApp</label>
                                        <input type="text" class="form-control" id="whatsapp">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="waBusiness" class="form-label"><i class="fab fa-whatsapp social-media-icons text-success"></i>WA Business</label>
                                        <input type="text" class="form-control" id="waBusiness">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="imo" class="form-label"><span class="imo-logo social-media-icons">IMO</span>Imo</label>
                                        <input type="text" class="form-control" id="imo">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="viber" class="form-label"><i class="fab fa-viber social-media-icons text-purple"></i>Viber</label>
                                        <input type="text" class="form-control" id="viber">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="twitter" class="form-label"><i class="fab fa-twitter social-media-icons text-info"></i>Twitter</label>
                                        <input type="text" class="form-control" id="twitter">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="messenger" class="form-label"><i class="fab fa-facebook-messenger social-media-icons text-primary"></i>Messenger</label>
                                        <input type="text" class="form-control" id="messenger">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="wechat" class="form-label"><i class="fab fa-weixin social-media-icons text-success"></i>WeChat</label>
                                        <input type="text" class="form-control" id="wechat">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="telegram" class="form-label"><i class="fab fa-telegram social-media-icons text-info"></i>Telegram</label>
                                        <input type="text" class="form-control" id="telegram">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="snapchat" class="form-label"><i class="fab fa-snapchat social-media-icons text-warning"></i>Snapchat</label>
                                        <input type="text" class="form-control" id="snapchat">
                                </div>
                            </div>
                            
                            <!-- Social Media -->
                            <div class="form-section">
                                <h4 class="section-title">Social Media</h4>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="facebook" class="form-label"><i class="fab fa-facebook social-media-icons text-primary"></i>Facebook</label>
                                        <input type="url" class="form-control" id="facebook">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="linkedin" class="form-label"><i class="fab fa-linkedin social-media-icons text-primary"></i>LinkedIn</label>
                                        <input type="url" class="form-control" id="linkedin">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="instagram" class="form-label"><i class="fab fa-instagram social-media-icons text-danger"></i>Instagram</label>
                                        <input type="url" class="form-control" id="instagram">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="youtube" class="form-label"><i class="fab fa-youtube social-media-icons text-danger"></i>YouTube</label>
                                        <input type="url" class="form-control" id="youtube">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="fiverr" class="form-label"><i class="fas fa-search-dollar social-media-icons text-success"></i>Fiverr</label>
                                        <input type="url" class="form-control" id="fiverr">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="upwork" class="form-label"><i class="fab fa-upwork upwork-logo social-media-icons"></i>Upwork</label>
                                        <input type="url" class="form-control" id="upwork">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="freelancer" class="form-label"><i class="fas fa-laptop-code social-media-icons text-info"></i>Freelancer</label>
                                    <input type="url" class="form-control" id="freelancer">
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="reset" class="btn btn-secondary">Reset Form</button>
                                <button type="submit" class="btn btn-primary">Save Contact</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Download Options -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-download me-2"></i>Download Options
                    </div>
                    <div class="card-body">
                        <div class="download-options">
                            <button class="btn btn-success" id="downloadCsvBtn"><i class="fas fa-file-csv me-2"></i>Download CSV</button>
                            <button class="btn btn-primary" id="downloadVcfBtn"><i class="fas fa-address-card me-2"></i>Download VCF</button>
                            <button class="btn btn-info" id="downloadQrBtn"><i class="fas fa-qrcode me-2"></i>Generate QR Code</button>
                            <button class="btn btn-warning" id="paymentBtn"><i class="fas fa-credit-card me-2"></i>Process Payment</button>
                        </div>
                        
                        <div class="qr-code-container" id="qrCodeContainer" style="display: none;">
                            <h5>QR Code</h5>
                            <div id="qrcode"></div>
                            <button class="btn btn-info qr-download-btn" id="saveQrBtn">
                                <i class="fas fa-download me-2"></i>Download QR Code as Image
                            </button>
                            <p class="mt-2">Scan this QR code to save the contact</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="payment-content">
            <h3>Payment Processing</h3>
            <p>Please enter your payment details</p>
            
            <div class="mb-3">
                <label for="cardNumber" class="form-label">Card Number</label>
                <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456">
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="expiryDate" class="form-label">Expiry Date</label>
                    <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY">
                </div>
                <div class="col-md-6">
                    <label for="cvv" class="form-label">CVV</label>
                    <input type="text" class="form-control" id="cvv" placeholder="123">
                </div>
            </div>
            
            <div class="mb-3">
                <label for="cardholderName" class="form-label">Cardholder Name</label>
                <input type="text" class="form-control" id="cardholderName" placeholder="John Doe">
            </div>
            
            <div class="d-flex justify-content-between">
                <button class="btn btn-secondary" id="cancelPaymentBtn">Cancel</button>
                <button class="btn btn-success" id="confirmPaymentBtn">Confirm Payment</button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p>&copy; 2023 Contact Information Manager. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Country list
        const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", 
            "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", 
            "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", 
            "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", 
            "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", 
            "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt", "El Salvador", 
            "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", 
            "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", 
            "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", 
            "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", 
            "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", 
            "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", 
            "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", 
            "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", 
            "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", 
            "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", 
            "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", 
            "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", 
            "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", 
            "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", 
            "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", 
            "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ];

        // Global variables
        let uploadedData = [];
        let imageBase64 = '';
        let fileHeaders = [];
        
        // DOM elements
        const authContainer = document.getElementById('authContainer');
        const appContainer = document.getElementById('appContainer');
        const signinForm = document.getElementById('signinForm');
        const signupForm = document.getElementById('signupForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const fileUpload = document.getElementById('fileUpload');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadStatus = document.getElementById('uploadStatus');
        const fileInfo = document.getElementById('fileInfo');
        const fileDetails = document.getElementById('fileDetails');
        const debugInfo = document.getElementById('debugInfo');
        const debugDetails = document.getElementById('debugDetails');
        const contactForm = document.getElementById('contactForm');
        const fetchDataBtn = document.getElementById('fetchDataBtn');
        const contactId = document.getElementById('contactId');
        const increaseIdBtn = document.getElementById('increaseIdBtn');
        const decreaseIdBtn = document.getElementById('decreaseIdBtn');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const countryPersonal = document.getElementById('countryPersonal');
        const countryWork = document.getElementById('countryWork');
        const downloadCsvBtn = document.getElementById('downloadCsvBtn');
        const downloadVcfBtn = document.getElementById('downloadVcfBtn');
        const downloadQrBtn = document.getElementById('downloadQrBtn');
        const paymentBtn = document.getElementById('paymentBtn');
        const paymentModal = document.getElementById('paymentModal');
        const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
        const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
        const qrCodeContainer = document.getElementById('qrCodeContainer');
        const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
        const saveQrBtn = document.getElementById('saveQrBtn');
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
        
        // Field mapping for different naming conventions - FIXED VERSION
        const fieldMappings = {
        // ID fields
    'id': ['ID', 'Id', 'id', 'ContactID', 'Contact Id', 'Contact ID', 'ContactID', 'CONTACTID'],
            
           // Personal Information
    'firstName': ['FirstName', 'First Name', 'First_Name', 'firstname', 'first name', 'fname', 'FName', 'FIRSTNAME', 'Given Name', 'GivenName'],
    'middleName': ['MiddleName', 'Middle Name', 'Middle_Name', 'middlename', 'middle name', 'mname', 'MName', 'MIDDLENAME'],
    'lastName': ['LastName', 'Last Name', 'Last_Name', 'lastname', 'last name', 'lname', 'LName', 'LASTNAME', 'Surname', 'Family Name'],
    'nickName': ['NickName', 'Nick Name', 'Nick_Name', 'nickname', 'nick name', 'nick', 'Nick', 'NICKNAME'],
    'phoneHome': ['PhoneHome', 'Phone Home', 'Phone_Home', 'phonehome', 'home phone', 'homephone', 'HomePhone', 'HOME_PHONE', 'Home', 'Home Tel'],
    'phoneMobile': ['PhoneMobile', 'Phone Mobile', 'Phone_Mobile', 'phonemobile', 'mobile phone', 'mobile', 'cell', 'cellphone', 'Mobile', 'MobilePhone', 'MOBILE', 'Cell Phone'],
    'emailPersonal': ['EmailPersonal', 'Email Personal', 'Email_Personal', 'emailpersonal', 'personal email', 'email', 'Email', 'EMAIL', 'Personal Email'],
    'dob': ['DateOfBirth', 'Date of Birth', 'Date_of_Birth', 'dob', 'birthdate', 'birth date', 'DOB', 'Birthday'],
    'street1Personal': ['Street1Personal', 'Street 1 Personal', 'Street1 Personal', 'street1personal', 'personal street1', 'address1', 'Address1', 'Street1', 'Street 1'],
    'street2Personal': ['Street2Personal', 'Street 2 Personal', 'Street2 Personal', 'street2personal', 'personal street2', 'address2', 'Address2', 'Street2', 'Street 2'],
    'cityPersonal': ['CityPersonal', 'City Personal', 'City_Personal', 'citypersonal', 'personal city', 'city', 'City', 'CITY'],
    'zipPersonal': ['ZipPersonal', 'ZIP Personal', 'Zip_Personal', 'zippersonal', 'personal zip', 'zip', 'postal code', 'Zip', 'ZIP', 'PostalCode', 'Postal Code'],
    'countryPersonal': ['CountryPersonal', 'Country Personal', 'Country_Personal', 'countrypersonal', 'personal country', 'country', 'Country', 'COUNTRY'],
    
    // Work Information
    'company': ['Company', 'company', 'employer', 'Employer', 'COMPANY', 'Organization'],
    'department': ['Department', 'department', 'dept', 'Dept', 'DEPARTMENT'],
    'designation': ['Designation', 'designation', 'title', 'Title', 'Job Title', 'JobTitle', 'DESIGNATION'],
    'role': ['Role', 'role', 'position', 'Position', 'ROLE'],
    'phoneWork': ['PhoneWork', 'Phone Work', 'Phone_Work', 'phonework', 'work phone', 'workphone', 'WorkPhone', 'WORK_PHONE', 'Office Phone'],
    'emailWork': ['EmailWork', 'Email Work', 'Email_Work', 'emailwork', 'work email', 'work email', 'WorkEmail', 'WORK_EMAIL', 'Office Email'],
    'street1Work': ['Street1Work', 'Street 1 Work', 'Street1 Work', 'street1work', 'work street1', 'work address1', 'WorkAddress1', 'Work Street1'],
    'street2Work': ['Street2Work', 'Street 2 Work', 'Street2 Work', 'street2work', 'work street2', 'work address2', 'WorkAddress2', 'Work Street2'],
    'cityWork': ['CityWork', 'City Work', 'City_Work', 'citywork', 'work city', 'WorkCity'],
    'zipWork': ['ZipWork', 'ZIP Work', 'Zip_Work', 'zipwork', 'work zip', 'work postal code', 'WorkZip'],
    'countryWork': ['CountryWork', 'Country Work', 'Country_Work', 'countrywork', 'work country', 'WorkCountry'],
    'webAddress': ['WebAddress', 'Web Address', 'Web_Address', 'webaddress', 'website', 'Website', 'URL', 'Web'],
    
    // Instant Messaging
    'whatsapp': ['WhatsApp', 'Whatsapp', 'whatsapp', 'WA', 'WHATSAPP'],
    'waBusiness': ['WABusiness', 'WA Business', 'WA_Business', 'wabusiness', 'whatsapp business', 'WhatsApp Business'],
    'imo': ['Imo', 'imo', 'IMO'],
    'viber': ['Viber', 'viber', 'VIBER'],
    'twitter': ['Twitter', 'twitter', 'TWITTER'],
    'messenger': ['Messenger', 'messenger', 'fb messenger', 'Facebook Messenger'],
    'wechat': ['WeChat', 'Wechat', 'wechat', 'WECHAT'],
    'telegram': ['Telegram', 'telegram', 'TELEGRAM'],
    'snapchat': ['Snapchat', 'snapchat', 'SNAPCHAT'],
    
    // Social Media
    'facebook': ['Facebook', 'facebook', 'fb', 'FACEBOOK'],
    'linkedin': ['LinkedIn', 'Linkedin', 'linkedin', 'LINKEDIN'],
    'instagram': ['Instagram', 'instagram', 'insta', 'INSTAGRAM'],
    'youtube': ['YouTube', 'Youtube', 'youtube', 'yt', 'YOUTUBE'],
    'fiverr': ['Fiverr', 'fiverr', 'FIVERR'],
    'upwork': ['Upwork', 'upwork', 'UPWORK'],
    'freelancer': ['Freelancer', 'freelancer', 'FREELANCER']
};
        
        // Initialize the application
       // IMPROVED function to find field value in record using multiple possible field names
function findFieldValue(record, fieldKey) {
    const possibleNames = fieldMappings[fieldKey];
    if (!possibleNames) {
        console.log(`No mapping found for field: ${fieldKey}`);
        return '';
    }
    
    // First, try exact matches with case insensitivity
    for (const name of possibleNames) {
        // Check if the field exists in the record (case insensitive)
        const recordKeys = Object.keys(record);
        const matchingKey = recordKeys.find(key => 
            key.toLowerCase().replace(/\s+/g, '') === name.toLowerCase().replace(/\s+/g, '')
        );
        
        if (matchingKey && record[matchingKey] !== null && record[matchingKey] !== undefined && record[matchingKey] !== '') {
            console.log(`Found field ${fieldKey} as "${matchingKey}": ${record[matchingKey]}`);
            return record[matchingKey];
        }
    }
    
    // If no exact match, try partial matching
    for (const name of possibleNames) {
        const normalizedName = name.toLowerCase().replace(/\s+/g, '');
        const recordKeys = Object.keys(record);
        const matchingKey = recordKeys.find(key => 
            key.toLowerCase().replace(/\s+/g, '').includes(normalizedName) || 
            normalizedName.includes(key.toLowerCase().replace(/\s+/g, ''))
        );
        
        if (matchingKey && record[matchingKey] !== null && record[matchingKey] !== undefined && record[matchingKey] !== '') {
            console.log(`Found field ${fieldKey} as partial match "${matchingKey}": ${record[matchingKey]}`);
            return record[matchingKey];
        }
    }
    
    console.log(`Field not found: ${fieldKey}`);
    return '';
}

// IMPROVED function to fetch data from uploaded file
function fetchDataFromFile() {
    const id = contactId.value.trim();
    if (!id) {
        alert('Please enter a Contact ID');
        return;
    }
    
    if (uploadedData.length === 0) {
        alert('No data available. Please upload a file first.');
        return;
    }
    
    console.log('Looking for ID:', id);
    console.log('Available data headers:', fileHeaders);
    console.log('First record:', uploadedData[0]);
    
    // Find record by ID using multiple possible ID field names
    let record = null;
    const idFields = fieldMappings.id;
    
    for (const recordItem of uploadedData) {
        for (const idField of idFields) {
            // Case insensitive search for ID field
            const recordKeys = Object.keys(recordItem);
            const matchingKey = recordKeys.find(key => 
                key.toLowerCase().replace(/\s+/g, '') === idField.toLowerCase().replace(/\s+/g, '')
            );
            
            if (matchingKey && recordItem[matchingKey] && recordItem[matchingKey].toString().trim() === id.toString().trim()) {
                record = recordItem;
                console.log('Found record with ID field:', matchingKey, record);
                break;
            }
        }
        if (record) break;
    }
    
    if (!record) {
        alert(`No record found with ID: ${id}. Available IDs: ${uploadedData.map(r => {
            const idFields = fieldMappings.id;
            for (const idField of idFields) {
                const recordKeys = Object.keys(r);
                const matchingKey = recordKeys.find(key => 
                    key.toLowerCase().replace(/\s+/g, '') === idField.toLowerCase().replace(/\s+/g, '')
                );
                if (matchingKey && r[matchingKey]) return r[matchingKey];
            }
            return 'Unknown';
        }).join(', ')}`);
        return;
    }
    
    // Clear all form fields first to avoid data mixing
    const form = document.getElementById('contactForm');
    const inputs = form.querySelectorAll('input, select');
    inputs.forEach(input => {
        if (input.type !== 'file' && input.id !== 'contactId') {
            input.value = '';
        }
    });
    
    // Populate form with record data using improved field mapping
    document.getElementById('firstName').value = findFieldValue(record, 'firstName') || '';
    document.getElementById('middleName').value = findFieldValue(record, 'middleName') || '';
    document.getElementById('lastName').value = findFieldValue(record, 'lastName') || '';
    document.getElementById('nickName').value = findFieldValue(record, 'nickName') || '';
    document.getElementById('phoneHome').value = findFieldValue(record, 'phoneHome') || '';
    document.getElementById('phoneMobile').value = findFieldValue(record, 'phoneMobile') || '';
    document.getElementById('emailPersonal').value = findFieldValue(record, 'emailPersonal') || '';
    
    // Format date of birth
    const dobValue = findFieldValue(record, 'dob');
    document.getElementById('dob').value = formatDateOfBirth(dobValue) || '';
    
    document.getElementById('street1Personal').value = findFieldValue(record, 'street1Personal') || '';
    document.getElementById('street2Personal').value = findFieldValue(record, 'street2Personal') || '';
    document.getElementById('cityPersonal').value = findFieldValue(record, 'cityPersonal') || '';
    document.getElementById('zipPersonal').value = findFieldValue(record, 'zipPersonal') || '';
    document.getElementById('countryPersonal').value = findFieldValue(record, 'countryPersonal') || '';
    
    document.getElementById('company').value = findFieldValue(record, 'company') || '';
    document.getElementById('department').value = findFieldValue(record, 'department') || '';
    document.getElementById('designation').value = findFieldValue(record, 'designation') || '';
    document.getElementById('role').value = findFieldValue(record, 'role') || '';
    document.getElementById('phoneWork').value = findFieldValue(record, 'phoneWork') || '';
    document.getElementById('emailWork').value = findFieldValue(record, 'emailWork') || '';
    document.getElementById('street1Work').value = findFieldValue(record, 'street1Work') || '';
    document.getElementById('street2Work').value = findFieldValue(record, 'street2Work') || '';
    document.getElementById('cityWork').value = findFieldValue(record, 'cityWork') || '';
    document.getElementById('zipWork').value = findFieldValue(record, 'zipWork') || '';
    document.getElementById('countryWork').value = findFieldValue(record, 'countryWork') || '';
    document.getElementById('webAddress').value = findFieldValue(record, 'webAddress') || '';
    
    // Social media and instant messaging
    document.getElementById('whatsapp').value = findFieldValue(record, 'whatsapp') || '';
    document.getElementById('waBusiness').value = findFieldValue(record, 'waBusiness') || '';
    document.getElementById('imo').value = findFieldValue(record, 'imo') || '';
    document.getElementById('viber').value = findFieldValue(record, 'viber') || '';
    document.getElementById('twitter').value = findFieldValue(record, 'twitter') || '';
    document.getElementById('messenger').value = findFieldValue(record, 'messenger') || '';
    document.getElementById('wechat').value = findFieldValue(record, 'wechat') || '';
    document.getElementById('telegram').value = findFieldValue(record, 'telegram') || '';
    document.getElementById('snapchat').value = findFieldValue(record, 'snapchat') || '';
    document.getElementById('facebook').value = findFieldValue(record, 'facebook') || '';
    document.getElementById('linkedin').value = findFieldValue(record, 'linkedin') || '';
    document.getElementById('instagram').value = findFieldValue(record, 'instagram') || '';
    document.getElementById('youtube').value = findFieldValue(record, 'youtube') || '';
    document.getElementById('fiverr').value = findFieldValue(record, 'fiverr') || '';
    document.getElementById('upwork').value = findFieldValue(record, 'upwork') || '';
    document.getElementById('freelancer').value = findFieldValue(record, 'freelancer') || '';
    
    alert('Data fetched successfully! Check the form fields below.');
}
        
        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validate required fields
            if (!imageBase64) {
                alert('Please upload a profile image');
                return;
            }
            
            if (!document.getElementById('firstName').value || !document.getElementById('lastName').value || !document.getElementById('phoneMobile').value) {
                alert('Please fill all required fields (First Name, Last Name, Phone Mobile)');
                return;
            }
            
            // In a real application, you would save the data to a database
            alert('Contact saved successfully!');
        }
        
        // Download functions
        function downloadCsv() {
            if (!validateDownload()) return;
            
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const phoneMobile = document.getElementById('phoneMobile').value;
            
            // Create CSV content with column-wise format (single row with headers)
            const headers = [
                'FirstName', 'MiddleName', 'LastName', 'NickName', 'PhoneHome', 'PhoneMobile', 
                'EmailPersonal', 'DateOfBirth', 'Street1Personal', 'Street2Personal', 'CityPersonal', 
                'ZipPersonal', 'CountryPersonal', 'Company', 'Department', 'Designation', 'Role', 
                'PhoneWork', 'EmailWork', 'Street1Work', 'Street2Work', 'CityWork', 'ZipWork', 
                'CountryWork', 'WebAddress', 'WhatsApp', 'WABusiness', 'Imo', 'Viber', 'Twitter', 
                'Messenger', 'WeChat', 'Telegram', 'Snapchat', 'Facebook', 'LinkedIn', 'Instagram', 
                'YouTube', 'Fiverr', 'Upwork', 'Freelancer'
            ];
            
            const values = [
                firstName,
                document.getElementById('middleName').value,
                lastName,
                document.getElementById('nickName').value,
                document.getElementById('phoneHome').value,
                phoneMobile,
                document.getElementById('emailPersonal').value,
                document.getElementById('dob').value,
                document.getElementById('street1Personal').value,
                document.getElementById('street2Personal').value,
                document.getElementById('cityPersonal').value,
                document.getElementById('zipPersonal').value,
                document.getElementById('countryPersonal').value,
                document.getElementById('company').value,
                document.getElementById('department').value,
                document.getElementById('designation').value,
                document.getElementById('role').value,
                document.getElementById('phoneWork').value,
                document.getElementById('emailWork').value,
                document.getElementById('street1Work').value,
                document.getElementById('street2Work').value,
                document.getElementById('cityWork').value,
                document.getElementById('zipWork').value,
                document.getElementById('countryWork').value,
                document.getElementById('webAddress').value,
                document.getElementById('whatsapp').value,
                document.getElementById('waBusiness').value,
                document.getElementById('imo').value,
                document.getElementById('viber').value,
                document.getElementById('twitter').value,
                document.getElementById('messenger').value,
                document.getElementById('wechat').value,
                document.getElementById('telegram').value,
                document.getElementById('snapchat').value,
                document.getElementById('facebook').value,
                document.getElementById('linkedin').value,
                document.getElementById('instagram').value,
                document.getElementById('youtube').value,
                document.getElementById('fiverr').value,
                document.getElementById('upwork').value,
                document.getElementById('freelancer').value
            ];
            
            // Create CSV content
            let csvContent = headers.join(',') + '\n';
            csvContent += values.map(value => `"${value}"`).join(',');
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${firstName}_${lastName}_${phoneMobile}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function downloadVcf() {
            if (!validateDownload()) return;
            
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const phoneMobile = document.getElementById('phoneMobile').value;
            
            // Create comprehensive VCF content with all fields
            let vcfContent = "BEGIN:VCARD\n";
            vcfContent += "VERSION:3.0\n";
            vcfContent += `FN:${firstName} ${lastName}\n`;
            vcfContent += `N:${lastName};${firstName};;;\n`;
            
            // Personal Information
            if (document.getElementById('nickName').value) {
                vcfContent += `NICKNAME:${document.getElementById('nickName').value}\n`;
            }
            
            if (document.getElementById('phoneHome').value) {
                vcfContent += `TEL;TYPE=HOME,VOICE:${document.getElementById('phoneHome').value}\n`;
            }
            
            if (phoneMobile) {
                vcfContent += `TEL;TYPE=CELL,VOICE:${phoneMobile}\n`;
            }
            
            if (document.getElementById('phoneWork').value) {
                vcfContent += `TEL;TYPE=WORK,VOICE:${document.getElementById('phoneWork').value}\n`;
            }
            
            if (document.getElementById('emailPersonal').value) {
                vcfContent += `EMAIL;TYPE=PERSONAL,INTERNET:${document.getElementById('emailPersonal').value}\n`;
            }
            
            if (document.getElementById('emailWork').value) {
                vcfContent += `EMAIL;TYPE=WORK,INTERNET:${document.getElementById('emailWork').value}\n`;
            }
            
            if (document.getElementById('dob').value) {
                vcfContent += `BDAY:${document.getElementById('dob').value}\n`;
            }
            
            // Personal Address
            const street1 = document.getElementById('street1Personal').value;
            const street2 = document.getElementById('street2Personal').value;
            const city = document.getElementById('cityPersonal').value;
            const zip = document.getElementById('zipPersonal').value;
            const country = document.getElementById('countryPersonal').value;
            
            if (street1 || city || zip || country) {
                vcfContent += `ADR;TYPE=HOME:;;${street1};${city};;${zip};${country}\n`;
            }
            
            // Work Information
            if (document.getElementById('company').value) {
                vcfContent += `ORG:${document.getElementById('company').value}\n`;
            }
            
            if (document.getElementById('department').value) {
                vcfContent += `ORG:${document.getElementById('company').value || ''};${document.getElementById('department').value}\n`;
            }
            
            if (document.getElementById('designation').value) {
                vcfContent += `TITLE:${document.getElementById('designation').value}\n`;
            }
            
            if (document.getElementById('role').value) {
                vcfContent += `ROLE:${document.getElementById('role').value}\n`;
            }
            
            // Work Address
            const workStreet1 = document.getElementById('street1Work').value;
            const workStreet2 = document.getElementById('street2Work').value;
            const workCity = document.getElementById('cityWork').value;
            const workZip = document.getElementById('zipWork').value;
            const workCountry = document.getElementById('countryWork').value;
            
            if (workStreet1 || workCity || workZip || workCountry) {
                vcfContent += `ADR;TYPE=WORK:;;${workStreet1};${workCity};;${workZip};${workCountry}\n`;
            }
            
            // Web and Social
            if (document.getElementById('webAddress').value) {
                vcfContent += `URL:${document.getElementById('webAddress').value}\n`;
            }
            
            // Instant Messaging and Social Media
            if (document.getElementById('whatsapp').value) {
                vcfContent += `X-SOCIALPROFILE;TYPE=whatsapp:${document.getElementById('whatsapp').value}\n`;
            }
            
            if (document.getElementById('facebook').value) {
                vcfContent += `X-SOCIALPROFILE;TYPE=facebook:${document.getElementById('facebook').value}\n`;
            }
            
            if (document.getElementById('linkedin').value) {
                vcfContent += `X-SOCIALPROFILE;TYPE=linkedin:${document.getElementById('linkedin').value}\n`;
            }
            
            if (document.getElementById('twitter').value) {
                vcfContent += `X-SOCIALPROFILE;TYPE=twitter:${document.getElementById('twitter').value}\n`;
            }
            
            if (document.getElementById('instagram').value) {
                vcfContent += `X-SOCIALPROFILE;TYPE=instagram:${document.getElementById('instagram').value}\n`;
            }
            
            if (document.getElementById('youtube').value) {
                vcfContent += `X-SOCIALPROFILE;TYPE=youtube:${document.getElementById('youtube').value}\n`;
            }
            
            // Add photo if available
            if (imageBase64) {
                vcfContent += `PHOTO;ENCODING=B;TYPE=JPEG:${imageBase64.split(',')[1]}\n`;
            }
            
            // Notes section with additional data
            let notes = '';
            if (document.getElementById('waBusiness').value) notes += `WA Business: ${document.getElementById('waBusiness').value}\n`;
            if (document.getElementById('imo').value) notes += `Imo: ${document.getElementById('imo').value}\n`;
            if (document.getElementById('viber').value) notes += `Viber: ${document.getElementById('viber').value}\n`;
            if (document.getElementById('messenger').value) notes += `Messenger: ${document.getElementById('messenger').value}\n`;
            if (document.getElementById('wechat').value) notes += `WeChat: ${document.getElementById('wechat').value}\n`;
            if (document.getElementById('telegram').value) notes += `Telegram: ${document.getElementById('telegram').value}\n`;
            if (document.getElementById('snapchat').value) notes += `Snapchat: ${document.getElementById('snapchat').value}\n`;
            if (document.getElementById('fiverr').value) notes += `Fiverr: ${document.getElementById('fiverr').value}\n`;
            if (document.getElementById('upwork').value) notes += `Upwork: ${document.getElementById('upwork').value}\n`;
            if (document.getElementById('freelancer').value) notes += `Freelancer: ${document.getElementById('freelancer').value}\n`;
            
            if (notes) {
                vcfContent += `NOTE:${notes}\n`;
            }
            
            vcfContent += "END:VCARD";
            
            // Create and download file
            const blob = new Blob([vcfContent], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${firstName}_${lastName}_${phoneMobile}.vcf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // QR Code function
        function generateAndDisplayQrCode() {
            if (!validateDownload()) return;
            
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const phoneMobile = document.getElementById('phoneMobile').value;
            
            // Create comprehensive VCF content for QR code with ALL fields
            let vcfContent = "BEGIN:VCARD\n";
            vcfContent += "VERSION:3.0\n";
            vcfContent += `FN:${firstName} ${lastName}\n`;
            vcfContent += `N:${lastName};${firstName};;;\n`;
            
            // Personal Information
            if (document.getElementById('middleName').value) {
                vcfContent += `N:${lastName};${firstName};${document.getElementById('middleName').value};;\n`;
            }
            
            if (document.getElementById('nickName').value) {
                vcfContent += `NICKNAME:${document.getElementById('nickName').value}\n`;
            }
            
            if (document.getElementById('phoneHome').value) {
                vcfContent += `TEL;TYPE=HOME,VOICE:${document.getElementById('phoneHome').value}\n`;
            }
            
            if (phoneMobile) {
                vcfContent += `TEL;TYPE=CELL,VOICE:${phoneMobile}\n`;
            }
            
            if (document.getElementById('phoneWork').value) {
                vcfContent += `TEL;TYPE=WORK,VOICE:${document.getElementById('phoneWork').value}\n`;
            }
            
            if (document.getElementById('emailPersonal').value) {
                vcfContent += `EMAIL;TYPE=PERSONAL,INTERNET:${document.getElementById('emailPersonal').value}\n`;
            }
            
            if (document.getElementById('emailWork').value) {
                vcfContent += `EMAIL;TYPE=WORK,INTERNET:${document.getElementById('emailWork').value}\n`;
            }
            
            if (document.getElementById('dob').value) {
                vcfContent += `BDAY:${document.getElementById('dob').value}\n`;
            }
            
            // Personal Address
            const street1 = document.getElementById('street1Personal').value;
            const street2 = document.getElementById('street2Personal').value;
            const city = document.getElementById('cityPersonal').value;
            const zip = document.getElementById('zipPersonal').value;
            const country = document.getElementById('countryPersonal').value;
            
            if (street1 || city || zip || country) {
                vcfContent += `ADR;TYPE=HOME:;;${street1};${city};;${zip};${country}\n`;
            }
            
            // Work Information
            if (document.getElementById('company').value) {
                vcfContent += `ORG:${document.getElementById('company').value}\n`;
            }
            
            if (document.getElementById('department').value) {
                vcfContent += `ORG:${document.getElementById('company').value || ''};${document.getElementById('department').value}\n`;
            }
            
            if (document.getElementById('designation').value) {
                vcfContent += `TITLE:${document.getElementById('designation').value}\n`;
            }
            
            if (document.getElementById('role').value) {
                vcfContent += `ROLE:${document.getElementById('role').value}\n`;
            }
            
            // Work Address
            const workStreet1 = document.getElementById('street1Work').value;
            const workStreet2 = document.getElementById('street2Work').value;
            const workCity = document.getElementById('cityWork').value;
            const workZip = document.getElementById('zipWork').value;
            const workCountry = document.getElementById('countryWork').value;
            
            if (workStreet1 || workCity || workZip || workCountry) {
                vcfContent += `ADR;TYPE=WORK:;;${workStreet1};${workCity};;${workZip};${workCountry}\n`;
            }
            
            // Web and Social
            if (document.getElementById('webAddress').value) {
                vcfContent += `URL:${document.getElementById('webAddress').value}\n`;
            }
            
            // Instant Messaging and Social Media
            const socialProfiles = [
                { type: 'whatsapp', value: document.getElementById('whatsapp').value },
                { type: 'wabusiness', value: document.getElementById('waBusiness').value },
                { type: 'imo', value: document.getElementById('imo').value },
                { type: 'viber', value: document.getElementById('viber').value },
                { type: 'twitter', value: document.getElementById('twitter').value },
                { type: 'messenger', value: document.getElementById('messenger').value },
                { type: 'wechat', value: document.getElementById('wechat').value },
                { type: 'telegram', value: document.getElementById('telegram').value },
                { type: 'snapchat', value: document.getElementById('snapchat').value },
                { type: 'facebook', value: document.getElementById('facebook').value },
                { type: 'linkedin', value: document.getElementById('linkedin').value },
                { type: 'instagram', value: document.getElementById('instagram').value },
                { type: 'youtube', value: document.getElementById('youtube').value },
                { type: 'fiverr', value: document.getElementById('fiverr').value },
                { type: 'upwork', value: document.getElementById('upwork').value },
                { type: 'freelancer', value: document.getElementById('freelancer').value }
            ];
            
            socialProfiles.forEach(profile => {
                if (profile.value) {
                    vcfContent += `X-SOCIALPROFILE;TYPE=${profile.type}:${profile.value}\n`;
                }
            });
            
            // Add photo if available
            if (imageBase64) {
                vcfContent += `PHOTO;ENCODING=B;TYPE=JPEG:${imageBase64.split(',')[1]}\n`;
            }
            
            vcfContent += "END:VCARD";
            
            console.log('QR Code VCF Content:', vcfContent);
            
            // Generate QR code
            try {
                const qr = qrcode(0, 'M');
                qr.addData(vcfContent);
                qr.make();
                
                // Display QR code
                const qrCodeElement = document.getElementById('qrcode');
                qrCodeElement.innerHTML = '';
                qrCodeElement.appendChild(qr.createImgTag(5));
                qrCodeContainer.style.display = 'block';
                
                // Scroll to QR code
                qrCodeContainer.scrollIntoView({ behavior: 'smooth' });
                
                alert('QR Code generated successfully!');
            } catch (error) {
                console.error('QR Code generation error:', error);
                alert('Error generating QR code. Please try again.');
            }
        }
        
        function downloadQrCodeImage() {
            const qrCodeImg = document.querySelector('#qrcode img');
            if (!qrCodeImg) {
                alert('Please generate a QR code first by clicking "Generate QR Code"');
                return;
            }
            
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const phoneMobile = document.getElementById('phoneMobile').value;
            
            // Create a canvas to draw the QR code
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // Convert canvas to image and download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${firstName}_${lastName}_${phoneMobile}_qrcode.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                });
            };
            
            img.src = qrCodeImg.src;
        }
        
        function validateDownload() {
            if (!document.getElementById('firstName').value || !document.getElementById('lastName').value || !document.getElementById('phoneMobile').value) {
                alert('Please fill all required fields (First Name, Last Name, Phone Mobile) before downloading');
                return false;
            }
            return true;
        }
        
        // Payment functions
        function showPaymentModal() {
            if (!validateDownload()) return;
            paymentModal.style.display = 'flex';
        }
        
        function hidePaymentModal() {
            paymentModal.style.display = 'none';
        }
        
        function processPayment() {
            const cardNumber = document.getElementById('cardNumber').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            const cardholderName = document.getElementById('cardholderName').value;
            
            // Simple validation
            if (!cardNumber || !expiryDate || !cvv || !cardholderName) {
                alert('Please fill all payment details');
                return;
            }
            
            // Simulate payment processing
            setTimeout(() => {
                hidePaymentModal();
                alert('Payment received! You may now download the files.');
                
                // Clear payment form
                document.getElementById('cardNumber').value = '';
                document.getElementById('expiryDate').value = '';
                document.getElementById('cvv').value = '';
                document.getElementById('cardholderName').value = '';
            }, 1500);
        }
        
        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
